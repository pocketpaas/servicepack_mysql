#!/bin/bash

BUILD_TYPE=${1:-all}

DEFAULT_PASS=testpass

if [[ $BUILD_TYPE = 'all' || $BUILD_TYPE = 'base' ]]; then

    # neuter upstart
    dpkg-divert --local --rename --add /sbin/initctl
    ln -s /bin/true /sbin/initctl

    # install mysql server
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get install mysql-server-5.5 -y
fi

if [[ $BUILD_TYPE = 'all' || $BUILD_TYPE = 'setup' ]]; then
    echo "setting up service"

    /usr/bin/mysqld_safe --skip-grant-tables &
    sleep 5
    echo "Setting root mysql password"
    mysql -u root -e "update user set password=password('$MYSQL_ROOT_PASSWORD')" mysql
fi

